service: hotwire
image: dielume/hotwire

servers:
  web:
    - 143.198.234.234

registry:
  username: dielume
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  clear:
    DB_HOST: 143.198.234.234
    RAILS_SERVE_STATIC_FILES: true
    RAILS_LOG_TO_STDOUT: true
    PT_SILENCE_AR_COMPAT_WARNING: true
  secret:
    - RAILS_MASTER_KEY
    - POSTGRES_PASSWORD
    - REDIS_URL

accessories:
  redis:
    image: redis:6.2.4
    host: 143.198.234.234
    port: 6379
    env:
      directories:
        - data:/data

  db:
    image: postgres:13.3
    host: 143.198.234.234
    port: 5432
    env:
      clear:
        POSTGRES_USER: postgres
        POSTGRES_DB: hotwire_production
      secret:
        - POSTGRES_PASSWORD
    directories:
      - data:/var/lib/postgresql/data
